# Телеграм бот для опросов

## Установка
Нужен Docker (в идеале version 25.0.3, build 4debf41) и Docker Compose (version v2.24.5).

Перед сборкой нужно переименовать файл `.env.example` в `.env`.
В нем указать актуальные значения для:
- `BOT_TOKEN`. Ключ-токен для телеграм бота, получить у @BotFather

Собираем образ:
```shell
git clone ...
cd survey_bot
docker-compose -f docker-compose.prod.yml up --build -d
```

Все должно работать.

## Использование

### Команды бота:

#### Начало работы

Команда `/start` регистрирует пользователя в базе данных.

Доступ к команде не ограничен.

#### Запуск голосования

Команда `/vote` загружает данные о текущем опросе и запускает голосование.
Если текущий опрос пользователь не проходил, будет оправлено сообщение с вопросом и пользователю будет предложено его пройти.
Если текущий опрос отсутсвует или пользователь его прошел, тогда будет отправлено соответсвующее сообщение.

Доступ к команде не ограничен.

#### Добавление админа

Команда `/getadmin` добавляет админа. Для этого пользователю надо написать команду и через пробел написать секретный ключ.

Доступ к команде не ограничен.

#### Получение временного ключа

Команда `/getkey` возвращает случайный ключ для команды `/getadmin`. Время жизни ключа - 5 минут.

Доступ к команде имеет только **админ**.

#### Отправка ответов по текущему опросу

Команда `/export` возвращает ответы пользователей на опросы. 
Может вернуть ответы в разных форматах: txt, csv, json

Доступ к команде имеет только **админ**.

#### Завершение опроса

Команда `/finish` завершает опрос.

Доступ к команде имеет только **админ**.

#### Тестовая команда

Команда `/foobar` нужна для разработки и должна ничего не делать.

Доступ к команде имеет только **админ**.

### Добавление опроса

Добавить опрос может только **админ**.

Чтобы добавить опрос, нужно оправить в бота файл формата .csv (пример тут doc/survey_example.csv).
Если предпологается ответ не по вариантам (сам пользователь пишет), то строку оставляем пустой кроме первого столбца.

Если документ обработан без ошибок, то он будет добавлен в базу данных под номером `max_id + 1` и будет считаться текущим.

**ВАЖНО!** Добавление расчитано под формат Excel CSV, то есть разделитель должен быть точка с запятой `;`, иначе работать не будет.
Впрочем, при любой ошибке бот отправит эту ошибку.



